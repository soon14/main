<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge" />
		<meta name="robots" content="nofollow" />
		<meta name="robots" content="noarchive" />
        <title>知识库_文章发表</title>
        <meta name="description" content="" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link rel="stylesheet" href="__PUBLIC__/Css/sysAnnouncement/normalize.css" />
        <link rel="stylesheet" href="__PUBLIC__/Css/sysAnnouncement/main.css" />
        <link href="__PUBLIC__/uploadify/css/uploadify.css" rel="stylesheet" type="text/css" media="screen"/>
        <script>
			var TP_ROOT = "__ROOT__";
			var TP_TMPL = "__TMPL__";
			var TP_APP  = "__APP__";
			var TP_PUBLIC  = "__PUBLIC__";
			var TP_URL  = "__URL__";
			var TP_DECIMAL='{:getDigits(0,false)}';
			var dialogMaskNum = 0;
		</script>
        <script src="__PUBLIC__/Js/jquery-1.7.1.js" type="text/javascript"></script>
        <script src="__PUBLIC__/uploadify/scripts/jquery.uploadify.js" type="text/javascript"></script>
        <script>
	        function ajaxDoneTwo(json){
	        	if(json!=undefined && json){
	        		if(json.statusCode===undefined&&json.message===undefined){
			        	return alert(json);
		        	}
	        	}
	        };
        	function jsonEval(data){
	        	try{
	        		if($.type(data)=='string')
	        		return eval('('+data+')');
	        		else return data;
        		}catch(e){
	        		return{};
	        	}
	        };
	        function uploadifyError(event,queueId,fileObj,errorObj){
	        	alert("event:"+event+"\nqueueId:"+queueId+"\nfileObj.name:"+fileObj.name+"\nerrorObj.type:"+errorObj.type+"\nerrorObj.info:"+errorObj.info);
	        };
	        
	        function onUploadComplete(event,queueId,fileObj,response,data){
	        	ajaxDoneTwo(jsonEval(response));
	       	};
	        function onUploadSuccess(file, data, response) {
	        	var s=data.split(TP_PUBLIC+"/Uploadstemp/");
	        	var html='<input name="swf_upload_save_name[]" value="'+s[1]+'" type="hidden" /><input name="swf_upload_source_name[]" value="'+file.name+'" type="hidden" />';
	        	$('#' + file.id).find('.swf_upload_save_name').append(html);
	        };
       		$(function() {
	        	if($.fn.uploadify){
	        		$(":file[uploader]").each(function(){
	        		var $this=$(this);
	        		var options={
	        		swf:$this.attr("swf")||TP_PUBLIC+"/uploadify/scripts/uploadify.swf",
	        		uploader:TP_PUBLIC+"/uploadify.php",
	        		width:$this.attr("width")||104,
	        		height:$this.attr("height")||25,
	        		script:$this.attr("script"),
	        		buttonImage:$this.attr("buttonImage")||TP_PUBLIC+"/uploadify/upload.png",
	        		cancelImg:$this.attr("cancelImg"),
	        		queueID:$this.attr("id")+"-queue",
	        		fileTypeDesc:$this.attr("fileTypeDesc")||"*.jpg;*.jpeg;*.gif;*.png;*.doc;*.xls;*.csv;*.zip;*.pdf;*.xlsx;*.ppt;*.docx;*.rar;",
	        		fileTypeExts:$this.attr("fileTypeExts")||"*.jpg;*.jpeg;*.gif;*.png;*.doc;*.xls;*.csv;*.zip;*.pdf;*.xlsx;*.ppt;*.docx;*.rar;",
	        		uploadLimit:$this.attr("uploadLimit")||"5",
	        		queueSizeLimit:$this.attr("queueSizeLimit")||"5",
	        		fileSizeLimit:$this.attr("fileSizeLimit")||"100MB",
	        		fileDataName:$this.attr("name")||"file",
	        		auto:$this.attr("auto")||false,
	        		multi:$this.attr("multi")||true,
	        		removeCompleted:false,
	        		onError:uploadifyError,
	        		onUploadComplete:onUploadComplete,
	        		onUploadSuccess:onUploadSuccess};
	        		if($this.attr("onUploadSuccess")){
	        		options.onUploadSuccess=jsonEval($this.attr("onUploadSuccess"));}
	        		if($this.attr("onUploadComplete")){
	        		options.onUploadComplete=jsonEval($this.attr("onUploadComplete"));}
	        		if($this.attr("scriptData")){
	        		options.scriptData=jsonEval($this.attr("scriptData"));}
	        		if($this.attr("formData")){
	        		    var f=jsonEval($this.attr("formData"));
	        		    if(f.uploadpath) f.uploadpath=TP_PUBLIC+"/Uploadstemp/"+f.uploadpath;
	        		    options.formData=f;
	        		}
	        		$this.uploadify(options);});}
        	})
        </script>
        <!-- UEditor 初始化 -->
		<script type="text/javascript">
			window.UEDITOR_HOME_URL = '__ROOT__/Public/ueditor/';
			window.onload = function(){
				 window.UEDITOR_CONFIG.initialFrameWidth = 628;
				 window.UEDITOR_CONFIG.initialFrameHeight = 320;
				 window.UEDITOR_CONFIG.maxImageSideLength = 600;    
				 window.UEDITOR_CONFIG.toolbars = [
				            ['fullscreen', 'source', '|', 'undo', 'redo', '|',
				                'bold', 'italic', 'underline', 'fontborder', 'strikethrough', 'superscript', 'attachment', 'subscript', 'removeformat', 'formatmatch', 'autotypeset', 'blockquote', 'pasteplain', '|', 'forecolor', 'backcolor',  'cleardoc', '|',
				                'rowspacingtop', 'rowspacingbottom', 'lineheight', '|','customstyle', 'paragraph', 'fontfamily', 'fontsize', '|',
				                 'indent', '|', 'justifyleft', 'justifycenter', 'justifyright', 'justifyjustify', '|', 'touppercase', 'tolowercase', '|',
				                'link', 'unlink', 'anchor', '|', 'imagenone', 'imageleft', 'imageright', 'imagecenter', '|',
				                'insertimage', 'emotion',  'gmap','insertcode',  '|',
				                'horizontal', 'date', 'time', 'spechars',  '|','charts', '|', 'preview', 'searchreplace']
				        ]
				 UE.getEditor('content');
			}
		</script>
		<load href="__PUBLIC__/ueditor/ueditor.config.js" />
		<load href="__PUBLIC__/ueditor/ueditor.all.min.js" />
      	<script type="text/javascript">
				function lookupson(obj) {
					var bepart = $(obj).val();
					var $ref = $("#bepart");
					$.ajax({
						type : 'POST',
						dataType : "json",
						url : "__URL__/lookupgetsontypelist",
						cache : false,
						data : {bepart : bepart},
						success : function(json) {
							var html = '';
							$.each(json, function(i) {
								html += '<option value="'+json[i].id+'">' + json[i].name+ '</option>';
								
							});
							$ref.empty();
							$ref.append(html);
						},
					})
				} 
				//检查提交信息
				function checktext(obj){
					var title = $("#title").val();
					var content = $("#content").val();
					var titlel = title.length;
					var contentl = content.length;
					if(titlel < 1 ){
						alert("请填写标题!");
						return false;
					}
					if(titlel > 60){
						alert("输入的标题不超过60字!");
						return false;
					}
					if(contentl < 20){
						alert("请输入文章类容不少于20字!");
						return false;
					}
					$("form:last").submit();
				}
		</script>
    </head>
    <body>
		<div class="k">
			<div class="header">
				<div class="container">
					<h1 class="logo">
						<if condition="$Copany_Info['picture']">
								<img alt="logo" src="__PUBLIC__/Uploads/{$Copany_Info['picture']}" />
						</if>
					</h1>
					<h2 class="title">&nbsp;知识库</h2>
					<div class="search header-search">
						<form action="__URL__/more" class="form search-form" method="get">
							<input style="font-size:13px;" class="search-input" type="text" name='keywords' value='{$keywords}' placeholder="请输入时间如 2013-04-12或文章标题..."/>
							<button class ="search-btn" type="submit">搜索</button>
							<div class="header-link"><a class="btn btn-info" href="__URL__/knowledgepublish">发表文章</a></div>
						</form>
					</div>
				</div>
			</div>
			<!-- end header -->
	
			<div class="container clearfix">
				<div class="box2">
					<div class="box2-header">
						<div class="box-item">
							<a class="expert-ask" href="__URL__/knowledge">返回首页 &gt;&gt;</a>
						</div>
						<h2 class="box2-title">
							<span class="box2-title-txt">文章发表</span>
						</h2>
					</div>
					<div class="box2-body article-list-wrap">
					<form action="__URL__/lookupinsertkon" method="POST" ><!-- enctype="multipart/form-data" -->
						<div class="ask">
							<div class="ask-title">
								<div class="clearfix mb10">
									<div class="ask-title-intro">
										<span>文章标题</span>
									</div>
								</div>
								<div>
									<textarea class="ask-input" placeholder="请在这里输入文章标题" name="title" id="title" style="width:620px;"></textarea>
								</div>
								<div class="text-right">
									<a href="javascript:;"><span class="icon-txt text-muted" title="最多输入50个字符">文章规范 </span><span class="icon i-info"></span></a>
								</div>
							</div>
							<h4>文章内容</h4>
							<div class="ask-editor">
								<textarea  name="content" id="content" style="width:630px;height:350px;"></textarea>
								<input type="hidden" name="orderno" value="{$orderno}"/> 
							</div>
							<div class="ask-bar clearfix">
								<div class="ask-category">
									<!-- 二级联动 -->		
									<div class="">									
										<span>
											<if condition="$topTypeList neq null">
												<label>所属分类：</label>
												<!-- 顶级分类 -->
												<select id="topselect" class="combox required" onchange="lookupson(this);">
														<volist name="topTypeList" id="toptype">
																<option value="{$toptype.id}">{$toptype.name}</option>
														</volist>
												</select>
											</if>
										</span>
										<span>
												<!-- 子级分类 -->
												<select id="bepart" name="categoryid" class="combox required">
														<volist name="sontypelist" id="vason">
																<option value="{$vason.id}">{$vason.name}</option>
														</volist>
												</select>
										</span>
									</div>
								</div>
							</div>
							<div>
								<!-- 附件信息 -->
								{:W('ShowUpload')}
							</div>
							<div class="ask-footer text-right">
									<button class="ask-btn" type="button" onclick="checktext(this)">发表</button>
									<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
							</div>
						</div><!-- end ask -->
					</form>	
						
					</div>
				</div><!-- end box -->
			</div>
			<!-- end container -->
	
			<div class="footer">
				<p>Copyright © 2014 {:C('COPYRIGHT')}</p>
			</div>
		</div>
    </body>
</html>
